{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/layout.js"],"names":[],"mappings":"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","file":"layout.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\n\nvar MARGIN = 0.5\nvar HOFFSET = -0.1\nvar VOFFSET = -0.6\n\n/* Uncomment for automatic refresh */\n//document.getElementById('txtInput').onkeyup = Update\n//document.getElementById('txtInput').onchange = Update\n//window.onload = Update\n\ndocument.getElementById('btnInput').onclick = Update\n\nfunction viewport()\n{\n\tvar e = window,\n\t\ta = 'inner';\n\tif (!('innerWidth' in window)) {\n\t\ta = 'client';\n\t\te = document.documentElement || document.body;\n\t}\n\treturn {\n\t\twidth: e[a + 'Width'],\n\t\theight: e[a + 'Height']\n\t}\n}\n\nfunction Update()\n{\n\n\t/* read graph input */\n\tvar text = document.getElementById('txtInput').value\n\tvar graph = JSON.parse(text)\n\n\tif(!graph.nodes)\n\t\treturn;\n\n\t/* measure size of leaf boxes */\n\tgraph.nodes.forEach(measureSizeRec)\n\n\tvar width = viewport().width;\n\tvar height = viewport().height;\n\n\tlayoutGraph(graph, width, height)\n\n}\n\nfunction layoutGraph(graph, width, height)\n{\n\n\t/* remove all svg elements */\n\tvar allSvgs = document.querySelectorAll(\"svg\");\n\t[].forEach.call(allSvgs, function(svg) {\n\t\tsvg.parentNode.removeChild(svg)\n\t})\n\n\tvar zoom = d3.behavior.zoom()\n\t    .on(\"zoom\", function() { redraw(svg) });\n\n\twidth = d3.select(\"#tdOutput\").width\n\theight = d3.select(\"#tdOutput\").height\n\n\tvar svg = d3.select(\"#tdOutput\")\n\t\t.append(\"svg\")\n\t\t.attr(\"id\", \"svgOutput\")\n\t\t.attr(\"xmlns\", \"http://www.w3.org/2000/svg\")\n\t\t.attr(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\")\n\t\t.attr(\"xmlns:ev\", \"http://www.w3.org/2001/xml-events\")\n\t\t.attr(\"version\", \"1.1\")\n\t\t.attr(\"baseprofile\", \"full\")\n\t\t.attr(\"width\", width)\n\t\t.attr(\"height\", height)\n    .call(zoom)\n\t\t.append(\"g\")\n\n\t// group shizzle\n\tvar root = svg.append(\"g\")\n\n\tvar layouter = klay.d3adapter();\n\n\tlayouter\n\t\t.nodes(graph.nodes)\n\t\t.links(graph.links)\n\t\t.size([width, height])\n\t\t.transformGroup(root)\n\t\t.options({\n\t\t\tedgeRouting: \"ORTHOGONAL\",\n        intCoordinates: false\n\t\t})\n    .defaultPortSize([2, 2])\n\n\tvar idfun = function(d) { return d.id; };\n\tvar labelfun = function(d) { return d.children ? \"\" : (d.name || \"\") };\n\n\tvar link = root.selectAll(\".link\")\n\t\t.data(graph.links)\n\t\t.enter()\n\t\t.append(\"path\")\n\t\t.attr(\"class\", \"link\")\n\t\t.attr(\"d\", \"M0 0\")\n\n\tvar node = root.selectAll(\".node\")\n\t\t.data(graph.nodes)\n\t\t.enter()\n\t\t.append(\"g\")\n\n\tnode.append(\"rect\")\n    .attr(\"class\", \"node\")\n\t\t.attr(\"width\", function(d){ return d.width || 0; })\n\t\t.attr(\"height\", function(d){ return d.height || 0; })\n\t\t.attr(\"x\", 0)\n\t\t.attr(\"y\", 0)\n\n\tnode.append(\"title\")\n\t\t.text(function(d) { return d.name; });\n\n\n\tnode.append(\"text\")\n\t\t.attr(\"x\", function(d){\n\t\t\tif(d.parent)\n\t\t\t\treturn (MARGIN / 2 + HOFFSET) * d.width;\n\t\t\telse\n\t\t\t\treturn 0;\n\t\t})\n\t\t.attr(\"y\", function(d){\n\t\t\t\tif(d.parent)\n\t\t\t\t\treturn (1 + MARGIN / 2 + VOFFSET) * d.height;\n\t\t\t\telse\n\t\t\t\t\treturn 0;\n\t\t})\n\t\t.text(labelfun)\n\t\t.attr(\"class\", \"label\");\n\n\tvar port = node.selectAll(\".port\")\n\t  .data(function(d) { return d.ports; })\n\t  .enter()\n\t  .append(\"rect\")\n\t  .attr(\"class\", \"port\")\n    .attr(\"width\", 2)\n    .attr(\"height\", 2)\n  \t.attr(\"x\", 0)\n  \t.attr(\"y\", 0)\n\n  port.append(\"title\")\n    .text(function(d) { return d.id; });\n\n\tlayouter\n\t\t.on(\"finish\", function(){ layouter_on_finish(layouter, node, link, port); })\n    .start()\n\n}\n\nfunction layouter_on_finish(layouter, node, link, port)\n{\n\n\t  // apply edge routes\n    link.transition().attr(\"d\", function(d) {\n      var path = \"\";\n      path += \"M\" + d.sourcePoint.x + \" \" + d.sourcePoint.y + \" \";\n      d.bendPoints.forEach(function(bp, i) {\n        path += \"L\" + bp.x + \" \" + bp.y + \" \";\n      });\n      path += \"L\" + d.targetPoint.x + \" \" + d.targetPoint.y + \" \";\n      return path;\n    });\n\n    // apply node positions\n    node.transition()\n      .attr(\"transform\", function(d) { return \"translate(\" + d.x + \" \" + d.y + \")\"});\n\n    // apply port positions\n    port.transition()\n      .attr(\"x\", function(d) { return d.x; })\n      .attr(\"y\", function(d) { return d.y; });\n\n}\n\nfunction measureSizeRec(obj)\n{\n\n\tobj.width = 0;\n\tobj.height = 0;\n\n\t// save parent pointer\n\tobj.parent = parent;\n\n\tif(obj.children)\n\t{\n\t\tobj.children.forEach(function(child) { measureSizeRec(child, obj) })\n\t}\n\telse if(obj.name)\n\t{\n\t\tvar dim = d3MeasureText(obj.name, \"label\")\n\t\tobj.width = (1 + MARGIN) * dim.width\n\t\tobj.height = (1 + MARGIN) * dim.height\n\t}\n\n}\n\nfunction redraw(svg)\n{\n  svg.attr(\"transform\", \"translate(\" + d3.event.translate + \")\"\n                          + \" scale(\" + d3.event.scale + \")\");\n}\n"]}